{% extends "base.html" %}

{% block title %}{{ video.title }} - 我的CMS{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <!-- 视频详情 -->
            <article class="video-detail">
                <header class="mb-4">
                    <h1 class="mb-3">{{ video.title }}</h1>
                    <div class="video-meta text-muted mb-4">
                        <i class="fas fa-user me-2"></i>{{ video.author }}
                        <span class="mx-2">|</span>
                        <i class="fas fa-calendar me-2"></i>{{ video.created_at.strftime('%Y年%m月%d日') }}
                        {% if video.category %}
                        <span class="mx-2">|</span>
                        <i class="fas fa-folder me-2"></i>{{ video.category }}
                        {% endif %}
                        <span class="mx-2">|</span>
                        <i class="fas fa-eye me-2"></i>{{ video.views }} 次观看
                    </div>
                    {% if video.tags %}
                    <div class="video-tags mb-3">
                        {% for tag in video.tags.split(',') %}
                        <span class="badge bg-light text-dark me-1">{{ tag.strip() }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </header>

                <!-- 视频播放器 -->
                <div class="video-player mb-4">
                    <div class="ratio ratio-16x9 bg-dark rounded">
                        {% if video.video_url.startswith('http') %}
                            {% if 'youtube.com' in video.video_url or 'youtu.be' in video.video_url %}
                                <iframe src="{{ video.video_url }}" frameborder="0" allowfullscreen></iframe>
                            {% elif 'bilibili.com' in video.video_url %}
                                <iframe src="{{ video.video_url }}" frameborder="0" allowfullscreen></iframe>
                            {% else %}
                                <video controls class="w-100 h-100">
                                    <source src="{{ video.video_url }}" type="video/mp4">
                                    您的浏览器不支持视频播放。
                                </video>
                            {% endif %}
                        {% else %}
                            <video controls class="w-100 h-100">
                                <source src="{{ url_for('static', filename=video.video_url) }}" type="video/mp4">
                                您的浏览器不支持视频播放。
                            </video>
                        {% endif %}
                    </div>
                </div>

                <!-- 视频描述 -->
                {% if video.description %}
                <div class="video-description mb-4">
                    <h5 class="mb-3">视频描述</h5>
                    <p class="lead">{{ video.description }}</p>
                </div>
                {% endif %}

                <!-- 视频信息 -->
                <div class="video-info card bg-light mb-4">
                    <div class="card-body">
                        <h5 class="card-title">视频信息</h5>
                        <table class="table table-borderless mb-0">
                            <tr>
                                <td width="120"><strong>视频标题</strong></td>
                                <td>{{ video.title }}</td>
                            </tr>
                            <tr>
                                <td><strong>发布者</strong></td>
                                <td>{{ video.author }}</td>
                            </tr>
                            <tr>
                                <td><strong>发布时间</strong></td>
                                <td>{{ video.created_at.strftime('%Y年%m月%d日') }}</td>
                            </tr>
                            {% if video.category %}
                            <tr>
                                <td><strong>分类</strong></td>
                                <td>{{ video.category }}</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td><strong>观看次数</strong></td>
                                <td>{{ video.views }} 次</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- 底部操作 -->
                <footer class="video-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <a href="{{ url_for('videos_list') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>返回视频列表
                            </a>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <button class="btn btn-outline-primary" onclick="shareVideo()">
                                <i class="fas fa-share me-2"></i>分享视频
                            </button>
                        </div>
                    </div>
                </footer>
            </article>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function shareVideo() {
    if (navigator.share) {
        navigator.share({
            title: '{{ video.title }}',
            text: '{{ video.description or "" }}',
            url: window.location.href,
        });
    } else {
        // 复制链接到剪贴板
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('链接已复制到剪贴板');
        });
    }
}
</script>
{% endblock %}
