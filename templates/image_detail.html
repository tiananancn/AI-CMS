{% extends "base.html" %}

{% block title %}{{ image.title }} - 我的CMS{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <!-- 图片详情 -->
            <article class="image-detail">
                <header class="mb-4">
                    <h1 class="mb-3">{{ image.title }}</h1>
                    <div class="image-meta text-muted mb-4">
                        <i class="fas fa-user me-2"></i>{{ image.author }}
                        <span class="mx-2">|</span>
                        <i class="fas fa-calendar me-2"></i>{{ image.created_at.strftime('%Y年%m月%d日') }}
                        {% if image.category %}
                        <span class="mx-2">|</span>
                        <i class="fas fa-folder me-2"></i>{{ image.category }}
                        {% endif %}
                        <span class="mx-2">|</span>
                        <i class="fas fa-eye me-2"></i>{{ image.views }} 次查看
                    </div>
                    {% if image.tags %}
                    <div class="image-tags mb-3">
                        {% for tag in image.tags.split(',') %}
                        <span class="badge bg-light text-dark me-1">{{ tag.strip() }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </header>

                <!-- 图片展示 -->
                <div class="image-display mb-4">
                    <div class="text-center">
                        <img src="{{ url_for('static', filename=image.filepath) }}"
                             class="img-fluid rounded shadow-lg"
                             alt="{{ image.title }}"
                             style="max-height: 600px; width: auto;">
                    </div>
                </div>

                <!-- 图片描述 -->
                {% if image.description %}
                <div class="image-description mb-4">
                    <h5 class="mb-3">图片描述</h5>
                    <p class="lead">{{ image.description }}</p>
                </div>
                {% endif %}

                <!-- 图片信息 -->
                <div class="image-info card bg-light mb-4">
                    <div class="card-body">
                        <h5 class="card-title">图片信息</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td width="120"><strong>图片标题</strong></td>
                                        <td>{{ image.title }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>发布者</strong></td>
                                        <td>{{ image.author }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>发布时间</strong></td>
                                        <td>{{ image.created_at.strftime('%Y年%m月%d日') }}</td>
                                    </tr>
                                    {% if image.category %}
                                    <tr>
                                        <td><strong>分类</strong></td>
                                        <td>{{ image.category }}</td>
                                    </tr>
                                    {% endif %}
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td width="120"><strong>文件名</strong></td>
                                        <td>{{ image.filename }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>文件大小</strong></td>
                                        <td>{{ (image.file_size / 1024 / 1024) | round(2) }} MB</td>
                                    </tr>
                                    <tr>
                                        <td><strong>文件类型</strong></td>
                                        <td>{{ image.mime_type }}</td>
                                    </tr>
                                    {% if image.width and image.height %}
                                    <tr>
                                        <td><strong>尺寸</strong></td>
                                        <td>{{ image.width }} × {{ image.height }} 像素</td>
                                    </tr>
                                    {% endif %}
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 底部操作 -->
                <footer class="image-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <a href="{{ url_for('images_list') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-2"></i>返回图片列表
                            </a>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <a href="{{ url_for('static', filename=image.filepath) }}" download class="btn btn-primary me-2">
                                <i class="fas fa-download me-2"></i>下载图片
                            </a>
                            <button class="btn btn-outline-primary" onclick="shareImage()">
                                <i class="fas fa-share me-2"></i>分享图片
                            </button>
                        </div>
                    </div>
                </footer>
            </article>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function shareImage() {
    if (navigator.share) {
        navigator.share({
            title: '{{ image.title }}',
            text: '{{ image.description or "" }}',
            url: window.location.href,
        });
    } else {
        // 复制链接到剪贴板
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('链接已复制到剪贴板');
        });
    }
}
</script>
{% endblock %}
