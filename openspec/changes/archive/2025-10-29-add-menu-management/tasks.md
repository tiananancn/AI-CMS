# 任务清单：首页菜单管理功能

## 阶段1：数据库模型和API开发

### [ ] 任务1：创建MenuItem数据模型
**描述：** 在 `models.py` 中添加MenuItem模型，支持层级菜单结构
**文件：** `models.py`
**实现要点：**
- [ ] 添加MenuItem类定义
- [ ] 配置自关联关系（parent-child）
- [ ] 添加必要索引（parent_id, order）
- [ ] 实现to_dict()方法
- [ ] 添加created_at/updated_at字段

### [ ] 任务2：初始化默认菜单数据
**描述：** 创建默认菜单项初始化函数
**文件：** `app.py`
**实现要点：**
- [ ] 添加init_menu_items()函数
- [ ] 检查是否已存在菜单数据
- [ ] 插入4个默认菜单项（首页、文章、视频、图片）
- [ ] 在应用启动时调用初始化函数

### [ ] 任务3：实现菜单管理API端点
**描述：** 开发RESTful API支持菜单CRUD操作
**文件：** `app.py`
**API端点：**
- [ ] GET `/api/admin/menu-items` - 获取所有菜单项
- [ ] POST `/api/admin/menu-items` - 创建菜单项
- [ ] PUT `/api/admin/menu-items/<id>` - 更新菜单项
- [ ] DELETE `/api/admin/menu-items/<id>` - 删除菜单项
- [ ] POST `/api/admin/menu-items/reorder` - 批量排序
- [ ] GET `/api/menu-items` - 获取前端渲染菜单

### [ ] 任务4：菜单渲染API
**描述：** 为前端提供菜单数据渲染接口
**实现要点：**
- [ ] 查询可见的菜单项
- [ ] 按order字段排序
- [ ] 构建树形结构数据
- [ ] 返回JSON格式

## 阶段2：管理界面开发

### [ ] 任务5：创建菜单管理页面模板
**描述：** 开发管理后台菜单管理界面
**文件：** `templates/admin/menu_management.html`
**功能要求：**
- [ ] 菜单项列表展示（树形结构）
- [ ] 添加/编辑菜单项表单
- [ ] 删除确认对话框
- [ ] 启用/禁用切换开关
- [ ] 拖拽排序功能
- [ ] 父菜单选择器

### [ ] 任务6：开发管理页面JavaScript
**描述：** 实现前端交互逻辑
**实现要点：**
- [ ] 菜单列表渲染
- [ ] 表单提交处理
- [ ] 拖拽排序（SortableJS）
- [ ] 删除操作确认
- [ ] 启用/禁用状态切换
- [ ] 错误提示和成功反馈

### [ ] 任务7：添加管理后台导航
**描述：** 在admin后台添加菜单管理入口
**文件：** `templates/admin/base.html`
**实现要点：**
- [ ] 在侧边栏添加"菜单管理"菜单项
- [ ] 设置菜单图标（fas fa-bars）
- [ ] 链接到 `/admin/menu-management`

### [ ] 任务8：创建菜单管理路由
**描述：** 添加管理页面路由
**文件：** `app.py`
**实现要点：**
- [ ] 添加 `/admin/menu-management` 路由
- [ ] 添加 `@login_required` 装饰器
- [ ] 渲染 `menu_management.html` 模板

## 阶段3：前端模板集成

### [ ] 任务9：修改base.html模板
**描述：** 将硬编码导航替换为动态菜单渲染
**文件：** `templates/base.html`
**实现要点：**
- [ ] 在控制器中获取菜单数据
- [ ] 修改导航栏HTML结构
- [ ] 渲染动态菜单项
- [ ] 支持下拉菜单渲染
- [ ] 保留现有样式

### [ ] 任务10：添加菜单数据获取
**描述：** 在首页路由中加载菜单数据
**文件：** `app.py`
**实现要点：**
- [ ] 修改 index 路由
- [ ] 查询菜单项数据
- [ ] 按层级排序
- [ ] 传递给模板

## 阶段4：测试和验证

### [ ] 任务11：功能测试
**描述：** 全面测试菜单管理功能
**测试项目：**
- [ ] 创建菜单项
- [ ] 编辑菜单项
- [ ] 删除菜单项（含子菜单）
- [ ] 排序功能
- [ ] 启用/禁用切换
- [ ] 前端菜单渲染
- [ ] 默认数据初始化

### [ ] 任务12：边界情况测试
**测试场景：**
- [ ] 空菜单列表
- [ ] 所有菜单隐藏
- [ ] 深层级菜单（3级以上）
- [ ] 删除有子菜单的父菜单
- [ ] 特殊字符处理
- [ ] URL验证

### [ ] 任务13：兼容性测试
**测试项目：**
- [ ] 现有页面导航正常
- [ ] 管理后台其他功能正常
- [ ] 响应式设计适配
- [ ] 移动端导航菜单
- [ ] 不同浏览器兼容性

## 阶段5：文档和优化

### [ ] 任务14：更新CLAUDE.md文档
**描述：** 在项目文档中添加菜单管理功能说明
**文件：** `CLAUDE.md`
**更新内容：**
- [ ] 添加MenuItem模型说明
- [ ] 菜单管理API文档
- [ ] 前端模板使用说明

### [ ] 任务15：性能优化
**优化项目：**
- [ ] 添加数据库索引
- [ ] 实现菜单缓存（可选）
- [ ] 优化数据库查询
- [ ] 前端代码压缩

### [ ] 任务16：安全检查
**安全措施：**
- [ ] XSS防护验证
- [ ] CSRF保护
- [ ] URL白名单验证
- [ ] 权限控制测试

## 验收标准

### 功能验收
- [ ] 管理员可通过界面创建、编辑、删除菜单项
- [ ] 支持拖拽重新排序
- [ ] 前端正确渲染动态菜单
- [ ] 支持多级下拉菜单
- [ ] 默认菜单项自动创建
- [ ] 隐藏菜单项不影响前端布局

### 代码质量
- [ ] 代码符合项目风格规范
- [ ] 添加必要的注释
- [ ] 错误处理完善
- [ ] 性能符合预期

### 用户体验
- [ ] 操作简单直观
- [ ] 反馈及时明确
- [ ] 移动端适配良好
- [ ] 与现有界面风格一致

## 依赖关系

- **阻塞依赖**：无
- **并行任务**：数据库模型开发可与前端模板修改并行进行
- **依赖顺序**：API开发 → 管理界面 → 前端集成 → 测试

## 预计工期

- **阶段1（数据库+API）**：1天
- **阶段2（管理界面）**：2天
- **阶段3（前端集成）**：1天
- **阶段4（测试）**：1天
- **阶段5（文档）**：0.5天

**总计**：约5.5个工作日

---

**最后更新：** 2025-10-29
**状态：** 待实施
