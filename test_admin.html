<!DOCTYPE html>
<html>
<head>
    <title>JavaScript æµ‹è¯•</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>å°é¢å›¾ç‰‡åŠŸèƒ½æµ‹è¯•</h1>

        <div class="mt-4">
            <button type="button" class="btn btn-outline-primary" onclick="showCoverImagePicker()">
                <i class="fas fa-images me-2"></i>ä»å›¾ç‰‡åº“é€‰æ‹©
            </button>
            <button type="button" class="btn btn-outline-secondary" onclick="uploadNewCoverImage()">
                <i class="fas fa-upload me-2"></i>ä¸Šä¼ æ–°å°é¢
            </button>
        </div>

        <div id="output" class="mt-4 alert alert-info" style="display:none;"></div>
    </div>

    <script>
        console.log('è„šæœ¬å¼€å§‹åŠ è½½...');

        // æµ‹è¯•å‡½æ•°1ï¼šå›¾ç‰‡åº“é€‰æ‹©
        function showCoverImagePicker() {
            console.log('showCoverImagePicker è¢«è°ƒç”¨!');
            document.getElementById('output').style.display = 'block';
            document.getElementById('output').innerHTML = '<h4>âœ… ä»å›¾ç‰‡åº“é€‰æ‹© - æŒ‰é’®åŠŸèƒ½æ­£å¸¸!</h4><p>æ­£åœ¨åŠ è½½å›¾ç‰‡åº“...</p>';

            // æµ‹è¯•APIè°ƒç”¨
            fetch('/api/images')
                .then(response => response.json())
                .then(images => {
                    console.log('å›¾ç‰‡åŠ è½½æˆåŠŸ:', images);
                    let html = '<h4>âœ… APIè°ƒç”¨æˆåŠŸ!</h4><p>æ‰¾åˆ° ' + images.length + ' å¼ å›¾ç‰‡:</p><ul>';
                    images.forEach(img => {
                        html += '<li>' + img.title + ' - ' + img.filepath + '</li>';
                    });
                    html += '</ul>';
                    document.getElementById('output').innerHTML = html;
                })
                .catch(error => {
                    console.error('APIè°ƒç”¨å¤±è´¥:', error);
                    document.getElementById('output').innerHTML = '<h4>âŒ APIè°ƒç”¨å¤±è´¥</h4><p>' + error + '</p>';
                });
        }

        // æµ‹è¯•å‡½æ•°2ï¼šä¸Šä¼ æ–°å°é¢
        function uploadNewCoverImage() {
            console.log('uploadNewCoverImage è¢«è°ƒç”¨!');
            document.getElementById('output').style.display = 'block';
            document.getElementById('output').innerHTML = '<h4>âœ… ä¸Šä¼ æ–°å°é¢ - æŒ‰é’®åŠŸèƒ½æ­£å¸¸!</h4><p>è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶...</p>';

            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    console.log('æ–‡ä»¶å·²é€‰æ‹©:', file.name, file.size);
                    document.getElementById('output').innerHTML = '<h4>âœ… æ–‡ä»¶é€‰æ‹©æˆåŠŸ!</h4><p>æ–‡ä»¶å: ' + file.name + '<br>å¤§å°: ' + (file.size/1024).toFixed(2) + ' KB</p>';
                }
            };
            input.click();
        }

        console.log('è„šæœ¬åŠ è½½å®Œæˆ!');
        document.getElementById('output').innerHTML = '<h4>ğŸš€ JavaScriptæµ‹è¯•é¡µé¢å·²å°±ç»ª</h4><p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•åŠŸèƒ½</p>';
        document.getElementById('output').style.display = 'block';
    </script>
</body>
</html>
